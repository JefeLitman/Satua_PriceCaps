{{ block content }}
    <!-- Version 1.0 -->
    <link rel="stylesheet" href="{{ static 'global/base.css' }}">
    <div class="row">
        <div class="container-fluid">
            <div class="row text-center mt-5">
                <div class="alert alert-primary" role="alert">
                    <h2 class="text-capitalize">Seccion 2 - Mercado</h2>
                </div>
            </div>
            <div class="row">
                <div class="container-fluid">
                    <div class="row text-center">
                        <p class="fs-5">Tu grupo es: <b>{{grupo}}</b></p>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p class="fs-5">Periodo actual: <b>{{periodo}}</b></p>
                        </div>
                        <div class="col text-end">
                            <p class="fs-5">Tiempo restante: <b id="timer"></b></p>
                        </div>
                    </div>
                    <div class="row">
                        <p class="fs-5">Número total de periodos: <b>{{total_periodos}}</b></p>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <div class="container-fluid">
                                <div class="row">
                                    <p class="fs-5">Su valor: <b>{{valor}}</b></p>
                                </div>
                                <div class="row">
                                    <p class="fs-5">¿Aceptada?: <b id="player_result"></b></p>
                                </div>
                                <div class="row">
                                    <p class="fs-5">Precio: <b id="player_price"></b></p>
                                </div>
                                <div class="row">
                                    <p class="fs-5">Ganancias: <b id="player_earnings"></b></p>
                                </div>
                            </div>
                        </div>
                        <div id="status" class="col-6 text-center align-self-center">
                            <button id="action" type="button" class="btn btn-success btn-lg">Hacer oferta y entrar al mercado</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row d-none">
                <input type="number" name="enter_bid" id="entered" value="0"/>
            </div>
        </div>
    </div>
    <script>
        setInterval(() => {
            document.getElementById("timer").innerHTML = document.getElementsByClassName("otree-timer__time-left")[0].innerHTML;
        }, 500);

        setInterval(() => {
            let participate = document.getElementById("entered").value;
            liveSend({'enter_bid': participate});
        }, 500);

        function liveRecv(data) {
            document.getElementById("player_result").innerHTML = data["accepted"];
            document.getElementById("player_price").innerHTML = data["price"];
            document.getElementById("player_earnings").innerHTML = data["earnings"];
        }

        function update_status(){
            let participation = document.getElementById("entered");
            let button = document.getElementById("action");
            if(parseInt(participation.value, 10)){
                participation.value = 0;
                button.classList.remove("btn-danger");
                button.classList.add("btn-success");
                button.innerHTML = "Hacer oferta y entrar al mercado";
            }
            else{
                participation.value = 1;
                button.classList.remove("btn-success");
                button.classList.add("btn-danger");
                button.innerHTML = "Quitar oferta y salir del mercado";
            }
            button.disabled = true;
            setTimeout(() => {
                button.disabled = false;
            }, 1000)
        }
        document.getElementById("action").onclick = update_status;
    </script>
{{ endblock }}
